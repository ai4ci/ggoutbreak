<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reproduction number estimate using the Cori method — rt_cori • ggoutbreak</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reproduction number estimate using the Cori method — rt_cori"><meta name="description" content="Calculate a reproduction number estimate from incidence data using a reimplementation
of the Cori method and an empirical generation time distribution. This uses
a mixture distribution to transmit uncertainty in generation time estimates.
A number of changes compared to the original EpiEstim implementation
have been made. Firstly there is no technical
limitation to the infectivity profile being strictly positive in time. This allows
use of serial intervals and secondary potentially delayed observations.
Secondly this implementation should tolerate missing count values (NA values
must be filtered out though). Thirdly for a given time point t this applies
all Rt estimates for which the window spans time point t rather than end
on time point t, which tends to address lag issues with the original,
and fourthly this implementation allows multiple window
widths to be calculated in parallel and aggregated. All of this tends to
increase uncertainty in the result particularly in the time dimension, which
addresses some of the issue seem with EpiEstim during the pandemic. Finally
it is quite a bit quicker, especially if approximate quantiles are all that
are needed."><meta property="og:description" content="Calculate a reproduction number estimate from incidence data using a reimplementation
of the Cori method and an empirical generation time distribution. This uses
a mixture distribution to transmit uncertainty in generation time estimates.
A number of changes compared to the original EpiEstim implementation
have been made. Firstly there is no technical
limitation to the infectivity profile being strictly positive in time. This allows
use of serial intervals and secondary potentially delayed observations.
Secondly this implementation should tolerate missing count values (NA values
must be filtered out though). Thirdly for a given time point t this applies
all Rt estimates for which the window spans time point t rather than end
on time point t, which tends to address lag issues with the original,
and fourthly this implementation allows multiple window
widths to be calculated in parallel and aggregated. All of this tends to
increase uncertainty in the result particularly in the time dimension, which
addresses some of the issue seem with EpiEstim during the pandemic. Finally
it is quite a bit quicker, especially if approximate quantiles are all that
are needed."><meta property="og:image" content="https://ai4ci.github.io/ggoutbreak/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggoutbreak</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ggoutbreak.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/covid-timeseries.html">England COVID-19 cases</a></li>
    <li><a class="dropdown-item" href="../articles/estimators-example.html">Simulation tests for growth rate estimators</a></li>
    <li><a class="dropdown-item" href="../articles/incidence-trends.html">Population comparisons and incidence</a></li>
    <li><a class="dropdown-item" href="../articles/infectivity-profile-discretisation.html">Infectivity profile discretisation</a></li>
    <li><a class="dropdown-item" href="../articles/rt-from-incidence.html">Estimating the reproduction number from modelled incidence</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-serial-interval.html">Sampling the infectivity profile from published serial interval estimates</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-test-models.html">Simulations and test harnesses</a></li>
    <li><a class="dropdown-item" href="../articles/time-periods.html">Data wrangling and working with `ggoutbreak`</a></li>
    <li><a class="dropdown-item" href="../articles/time-units.html">Estimating the reproduction number from weekly data</a></li>
    <li><a class="dropdown-item" href="../articles/variant-proportions.html">Multinomial proportions models for genomic variants</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/ggoutbreak/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reproduction number estimate using the Cori method</h1>
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/ggoutbreak/blob/HEAD/R/estimator-rt-cori.R" class="external-link"><code>R/estimator-rt-cori.R</code></a></small>
      <div class="d-none name"><code>rt_cori.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate a reproduction number estimate from incidence data using a reimplementation
of the Cori method and an empirical generation time distribution. This uses
a mixture distribution to transmit uncertainty in generation time estimates.
A number of changes compared to the original <code>EpiEstim</code> implementation
have been made. Firstly there is no technical
limitation to the infectivity profile being strictly positive in time. This allows
use of serial intervals and secondary potentially delayed observations.
Secondly this implementation should tolerate missing count values (NA values
must be filtered out though). Thirdly for a given time point <code>t</code> this applies
all <code>Rt</code> estimates for which the window spans time point <code>t</code> rather than end
on time point <code>t</code>, which tends to address lag issues with the original,
and fourthly this implementation allows multiple window
widths to be calculated in parallel and aggregated. All of this tends to
increase uncertainty in the result particularly in the time dimension, which
addresses some of the issue seem with <code>EpiEstim</code> during the pandemic. Finally
it is quite a bit quicker, especially if approximate quantiles are all that
are needed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rt_cori</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">i_incidence_input</span>,</span>
<span>  ip <span class="op">=</span> <span class="va">i_discrete_ip</span>,</span>
<span>  window <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  mean_prior <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  std_prior <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  epiestim_compat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  approx <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .progress <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>The count data. Extra groups are allowed. - a dataframe with columns:</p><ul><li><p>count (positive_integer) - Positive case counts associated with the specified time frame</p></li>
<li><p>time (ggoutbreak::time_period + group_unique) - A (usually complete) set of singular observations per unit time as a `time_period`</p></li>
</ul><p>Any grouping allowed.</p></dd>


<dt id="arg-ip">ip<a class="anchor" aria-label="anchor" href="#arg-ip"></a></dt>
<dd><p>A long format infectivity profile. - a dataframe with columns:</p><ul><li><p>boot (anything + default(1)) - a bootstrap identifier</p></li>
<li><p>probability (proportion) - the probability of new event during this period.</p></li>
<li><p>tau (integer + complete) - the days since the index event.</p></li>
</ul><p>Minimally grouped by: boot (and other groupings allowed).</p>
<p>A default value is defined.</p></dd>


<dt id="arg-window">window<a class="anchor" aria-label="anchor" href="#arg-window"></a></dt>
<dd><ul><li><p>the widths of the Cori method window to include in the estimate.
This can be a vector of values and all windows will be calculated and aggregated.</p></li>
</ul></dd>


<dt id="arg-mean-prior">mean_prior<a class="anchor" aria-label="anchor" href="#arg-mean-prior"></a></dt>
<dd><p>the prior for the $R_t$ estimate. When sample size is low the
$R_t$ estimate will revert to this prior. In <code>EpiEstim</code> the default is a high
number to allow detection of insufficient data but this tends to create
anomalies in the early part of infection time series. A possible value is $R_0$
but in fact this also will be a poor choice for the value of $R_t$ when case
numbers drop to a low value.</p></dd>


<dt id="arg-std-prior">std_prior<a class="anchor" aria-label="anchor" href="#arg-std-prior"></a></dt>
<dd><p>the prior for the $R_t$ SD.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>not used</p></dd>


<dt id="arg-epiestim-compat">epiestim_compat<a class="anchor" aria-label="anchor" href="#arg-epiestim-compat"></a></dt>
<dd><p>produce an estimate of <code>Rt</code> using only windows that end
on the time <code>t</code> rather than all windows that span time <code>t</code>. If this option is
selected there can also only be one value for window.</p></dd>


<dt id="arg-approx">approx<a class="anchor" aria-label="anchor" href="#arg-approx"></a></dt>
<dd><p>approximate the quantiles of the mixture distribution with a
gamma distribution with the same first mean and SD.</p></dd>


<dt id="arg--progress">.progress<a class="anchor" aria-label="anchor" href="#arg--progress"></a></dt>
<dd><p>show a CLI progress bar</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A dataframe containing the following columns:</p><ul><li><p>time (ggoutbreak::time_period + group_unique) - A (usually complete) set of singular observations per unit time as a <code>time_period</code></p></li>
<li><p>rt.fit (double) - an estimate of the reproduction number</p></li>
<li><p>rt.se.fit (positive_double) - the standard error of the reproduction number</p></li>
<li><p>rt.0.025 (double) - lower confidence limit of the reproduction number</p></li>
<li><p>rt.0.5 (double) - median estimate of the reproduction number</p></li>
<li><p>rt.0.975 (double) - upper confidence limit of the reproduction number</p></li>
</ul><p>Any grouping allowed.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There are still issues with large $R_t$ estimates in the early part of a
time series, which is a resul tof the renewal equaltion method.</p>
<p>This will calculate a reproduction number for each group in the input dataframe.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="test_poisson_rt_smooth.html">test_poisson_rt_smooth</a></span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp2</span> <span class="op">=</span> <span class="va">data</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">rt_cori</span><span class="op">(</span>ip<span class="op">=</span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="test_ip.html">test_ip</a></span>, epiestim_compat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmp3</span> <span class="op">=</span> <span class="va">data</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">rt_cori</span><span class="op">(</span>ip<span class="op">=</span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="test_ip.html">test_ip</a></span>, window<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span>, approx<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">comp</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">tmp2</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"EpiEstim"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">tmp3</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"Cori+"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot_rt.html">plot_rt</a></span><span class="op">(</span><span class="va">comp</span>, date_labels<span class="op">=</span><span class="st">"%b %y"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="sim_geom_function.html">sim_geom_function</a></span><span class="op">(</span><span class="va">data</span>,colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">3.0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

