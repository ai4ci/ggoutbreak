<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>England COVID-19 cases • ggoutbreak</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="England COVID-19 cases">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggoutbreak</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ggoutbreak.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/covid-timeseries.html">England COVID-19 cases</a></li>
    <li><a class="dropdown-item" href="../articles/estimators-example.html">Simulation tests for growth rate estimators</a></li>
    <li><a class="dropdown-item" href="../articles/incidence-trends.html">Population comparisons and incidence</a></li>
    <li><a class="dropdown-item" href="../articles/infectivity-profile-discretisation.html">Infectivity profile discretisation</a></li>
    <li><a class="dropdown-item" href="../articles/right-censoring.html">Estimating the reproduction number from right censored data</a></li>
    <li><a class="dropdown-item" href="../articles/rt-from-incidence.html">Estimating the reproduction number from modelled incidence</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-serial-interval.html">Sampling the infectivity profile from published serial interval estimates</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-test-models.html">Simulations and test harnesses</a></li>
    <li><a class="dropdown-item" href="../articles/time-periods.html">Data wrangling and working with `ggoutbreak`</a></li>
    <li><a class="dropdown-item" href="../articles/variant-proportions.html">Multinomial proportions models for genomic variants</a></li>
    <li><a class="dropdown-item" href="../articles/weekly-incidence.html">Estimating the reproduction number from weekly data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/ggoutbreak/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>England COVID-19 cases</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/ggoutbreak/blob/HEAD/vignettes/covid-timeseries.Rmd" class="external-link"><code>vignettes/covid-timeseries.Rmd</code></a></small>
      <div class="d-none name"><code>covid-timeseries.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="incidence-and-growth-rate-from-case-positive-counts">Incidence and growth rate from case positive counts<a class="anchor" aria-label="anchor" href="#incidence-and-growth-rate-from-case-positive-counts"></a>
</h2>
<p>This method uses a case positive count dataset bundled with growth
rates which is age stratified (age grouping is in the <code>class</code>
column). We will look at the age stratification in different vignettes
but in this instance we want to aggregate it into an England wide rate.
This is the purpose of <code><a href="../reference/time_aggregate.html">time_aggregate()</a></code> which performs a
simple summarisation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">england_covid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 26,790</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Groups: class [19]</span></span>
<span><span class="co">#&gt; $ date  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2023-12-09<span style="color: #949494;">, </span>2023-12-09<span style="color: #949494;">, </span>2023-12-09<span style="color: #949494;">, </span>2023-12-09<span style="color: #949494;">, </span>2023-12-09<span style="color: #949494;">, </span>202…</span></span>
<span><span class="co">#&gt; $ class <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 00_04<span style="color: #949494;">, </span>05_09<span style="color: #949494;">, </span>10_14<span style="color: #949494;">, </span>15_19<span style="color: #949494;">, </span>20_24<span style="color: #949494;">, </span>25_29<span style="color: #949494;">, </span>30_34<span style="color: #949494;">, </span>35_39<span style="color: #949494;">, </span>40_44<span style="color: #949494;">, </span>4…</span></span>
<span><span class="co">#&gt; $ count <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 24<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>21<span style="color: #949494;">, </span>20<span style="color: #949494;">, </span>29<span style="color: #949494;">, </span>36<span style="color: #949494;">, </span>41<span style="color: #949494;">, </span>59<span style="color: #949494;">, </span>53<span style="color: #949494;">, </span>54<span style="color: #949494;">, </span>56<span style="color: #949494;">, </span>54<span style="color: #949494;">, </span>67<span style="color: #949494;">, </span>72<span style="color: #949494;">, </span>56<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ denom <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">, </span>771<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ time  <span style="color: #949494; font-style: italic;">&lt;time_prd&gt;</span> 1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">, </span>1409<span style="color: #949494;">,</span>…</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_covid.html">england_covid</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/time_aggregate.html">time_aggregate</a></span><span class="op">(</span>count<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The raw COVID-19 case count on a <code>log1p</code> scale is the
total detected cases per day.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">=</span> <span class="va">tmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/poisson_locfit_model.html">poisson_locfit_model</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="../reference/plot_incidence.html">plot_incidence</a></span><span class="op">(</span><span class="va">fit</span>,raw <span class="op">=</span> <span class="va">tmp</span>, colour<span class="op">=</span><span class="st">"blue"</span>,size<span class="op">=</span><span class="fl">0.025</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/scale_y_log1p.html">scale_y_log1p</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>Major events in the timeseries can be plotted on the axes. We’ve
focussed on the first 2 years of the pandemic:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_incidence.html">plot_incidence</a></span><span class="op">(</span><span class="va">fit</span>, raw <span class="op">=</span> <span class="va">tmp</span>,events <span class="op">=</span> <span class="va">england_events</span>, colour<span class="op">=</span><span class="st">"blue"</span>,size<span class="op">=</span><span class="fl">0.025</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/scale_y_log1p.html">scale_y_log1p</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2022-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>The incidence model assumes case rates result from a Poisson process
and the rate is estimated with a time varying locally fitted polynomial
with degree defined by the <code>deg</code> parameter, using a log link
function, according to the methods of Loader et al. (see
<code>utils::citation("locfit")</code>). The fitting process is a local
maximum likelihood estimation and uses a bandwidth defined to account
for the data points within <code>window</code> of the time point being
estimated.</p>
<p>The gradient of the fitted polynomial on the log scale, is the
exponential growth rate. This is a scale independent view of the rate of
growth of the epidemic. This estimation methodology is compared to
consensus estimates from the SPI-M-O UK government advisory group in
red, shifted forward in time by 21 days. The SPI-M-O estimates made
during the pandemic were retrospective whereas these ones can use
information from before and after the time point and now may better
represent the timing of changes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_growth_rate.html">plot_growth_rate</a></span><span class="op">(</span><span class="va">fit</span>,events <span class="op">=</span> <span class="va">england_events</span>, colour<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2022-01-01"</span><span class="op">)</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span>,<span class="fl">0.15</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">england_consensus_growth_rate</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span><span class="op">-</span><span class="fl">21</span>,ymin<span class="op">=</span><span class="va">low</span>,ymax<span class="op">=</span><span class="va">high</span><span class="op">)</span>,colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>The state of the epidemic is described by both incidence and growth,
and the phase plots allow us to see both at different time points. In
this case the epidemic state in the 10 weeks leading up to Christmas in
2021, 2022 and 2023:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_growth_phase.html">plot_growth_phase</a></span><span class="op">(</span><span class="va">fit</span>,</span>
<span>    timepoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xmas 2020"</span><span class="op">=</span><span class="st">"2020-12-25"</span>,<span class="st">"Xmas 2021"</span><span class="op">=</span><span class="st">"2021-12-25"</span>,<span class="st">"Xmas 2022"</span><span class="op">=</span><span class="st">"2022-12-25"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    duration <span class="op">=</span> <span class="fl">70</span>, </span>
<span>    interval <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    colour<span class="op">=</span><span class="st">"blue"</span>,</span>
<span>    strip.position <span class="op">=</span> <span class="st">"top"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="reproduction-number-estimation">Reproduction number estimation<a class="anchor" aria-label="anchor" href="#reproduction-number-estimation"></a>
</h2>
<p>The growth rate has a unit or “per day” in this example. From it we
can derive the reproduction number, using the methods of Wallinga and
Lipsitch and an estimate of the infectivity profile of COVID-19. This
describes the probability that an infectee is infected x days after the
infector, and includes a temporal dimension rendering the reproduction
number a dimensionless quantity reflecting the average number of
infectees resulting from each infector.</p>
<p>We also have methods to infer the reproduction unmber from modelled
incidence estimates where logarithmic link functions are used. This is
described in the vignette:
<code><a href="../articles/rt-from-incidence.html">vignette("rt-from-incidence", package="ggoutbreak")</a></code></p>
<p><code>ggoutbreak</code> has an estimate of the infectivity profile
based on a meta-analysis of serial interval estimates of COVID-19. The
infectivity profile is a bootstrapped set of discrete probability
distributions. It is truncated at 14 days.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_ip.html">plot_ip</a></span><span class="op">(</span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/covid_ip.html">covid_ip</a></span>, alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>As with before effective
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
estimates are compared to consensus values from the SPI-M-O group
(red):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rt_fit</span> <span class="op">=</span> <span class="va">fit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/rt_from_incidence.html">rt_from_incidence</a></span><span class="op">(</span>ip <span class="op">=</span> <span class="va">covid_ip</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_rt.html">plot_rt</a></span><span class="op">(</span><span class="va">rt_fit</span>, events <span class="op">=</span> <span class="va">england_events</span>, colour<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2022-01-01"</span><span class="op">)</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">1.6</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">england_consensus_rt</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span><span class="op">-</span><span class="fl">14</span>,ymin<span class="op">=</span><span class="va">low</span>,ymax<span class="op">=</span><span class="va">high</span><span class="op">)</span>,colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<p><code>EpiEstim</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
fits for comparison for the same data, and the same infectivity profile
are much more certain and exhibit some oscillation due to the weekly
periodicity of the underlying time series. This oscillation is
accentuated by the truncated infectivity profile we are using here.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rt_epi_fit</span> <span class="op">=</span> <span class="va">tmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/rt_epiestim.html">rt_epiestim</a></span><span class="op">(</span>ip <span class="op">=</span> <span class="va">covid_ip</span>,window <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_rt.html">plot_rt</a></span><span class="op">(</span><span class="va">rt_epi_fit</span>, events <span class="op">=</span> <span class="va">england_events</span>, colour<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2022-01-01"</span><span class="op">)</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">1.6</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">england_consensus_rt</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span><span class="op">-</span><span class="fl">7</span>,ymin<span class="op">=</span><span class="va">low</span>,ymax<span class="op">=</span><span class="va">high</span><span class="op">)</span>,colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="prevalence-and-growth-rate-from-test-positivity-rates">Prevalence and growth rate from test positivity rates<a class="anchor" aria-label="anchor" href="#prevalence-and-growth-rate-from-test-positivity-rates"></a>
</h2>
<p>Test availability was not consistent during the pandemic. In the
early stages PCR tests were difficult to obtain and case positive
incidence estimates are thought to be a vast underestimate. During
certain parts of the pandemic targeted testing of high risk groups
occurred. Test positivity is a different view on the pandemic and
accounts for some of these biases and introduces others of its own. For
this the data must contain a <code>denom</code> column which in this
case represents the number of tests conducted:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">england_covid_pcr_positivity</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1,413</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; $ date  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2023-12-12<span style="color: #949494;">, </span>2023-12-11<span style="color: #949494;">, </span>2023-12-10<span style="color: #949494;">, </span>2023-12-09<span style="color: #949494;">, </span>2023-12-08<span style="color: #949494;">, </span>202…</span></span>
<span><span class="co">#&gt; $ time  <span style="color: #949494; font-style: italic;">&lt;time_prd&gt;</span> 1444<span style="color: #949494;">, </span>1443<span style="color: #949494;">, </span>1442<span style="color: #949494;">, </span>1441<span style="color: #949494;">, </span>1440<span style="color: #949494;">, </span>1439<span style="color: #949494;">, </span>1438<span style="color: #949494;">, </span>1437<span style="color: #949494;">, </span>1436<span style="color: #949494;">, </span>1435<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ count <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 375<span style="color: #949494;">, </span>509<span style="color: #949494;">, </span>381<span style="color: #949494;">, </span>350<span style="color: #949494;">, </span>445<span style="color: #949494;">, </span>399<span style="color: #949494;">, </span>430<span style="color: #949494;">, </span>457<span style="color: #949494;">, </span>413<span style="color: #949494;">, </span>295<span style="color: #949494;">, </span>252<span style="color: #949494;">, </span>293<span style="color: #949494;">, </span>343<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ denom <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1707<span style="color: #949494;">, </span>5884<span style="color: #949494;">, </span>5514<span style="color: #949494;">, </span>6001<span style="color: #949494;">, </span>7840<span style="color: #949494;">, </span>8333<span style="color: #949494;">, </span>8946<span style="color: #949494;">, </span>10139<span style="color: #949494;">, </span>9805<span style="color: #949494;">, </span>6445<span style="color: #949494;">, </span>638…</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fit2</span> <span class="op">=</span> <span class="va">england_covid_pcr_positivity</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/proportion_locfit_model.html">proportion_locfit_model</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_proportion.html">plot_proportion</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="va">england_covid_pcr_positivity</span>, events <span class="op">=</span> <span class="va">england_events</span>, size<span class="op">=</span><span class="fl">0.25</span>, colour<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2022-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>In this case the gradient of the proportion on the logistic scale is
an estimate of the growth rate. It is in some senses relative to the
growth of the testing effort but in this case produces an answer very
similar to the incidence model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_growth_rate.html">plot_growth_rate</a></span><span class="op">(</span><span class="va">fit2</span>, events <span class="op">=</span> <span class="va">england_events</span>, colour<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2022-01-01"</span><span class="op">)</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span>,<span class="fl">0.15</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">england_consensus_growth_rate</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span><span class="op">-</span><span class="fl">21</span>,ymin<span class="op">=</span><span class="va">low</span>,ymax<span class="op">=</span><span class="va">high</span><span class="op">)</span>,colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>With similar growth rate estimates this method can also theoretically
be used to calculate estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.
Growth-proportion phase diagrams can also compare different points in
times or as we will see elsewhere, between different populations.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_growth_phase.html">plot_growth_phase</a></span><span class="op">(</span><span class="va">fit2</span>,</span>
<span>    timepoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xmas 2020"</span><span class="op">=</span><span class="st">"2020-12-25"</span>,<span class="st">"Xmas 2021"</span><span class="op">=</span><span class="st">"2021-12-25"</span>,<span class="st">"Xmas 2022"</span><span class="op">=</span><span class="st">"2022-12-25"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    duration <span class="op">=</span> <span class="fl">70</span>, </span>
<span>    interval <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    colour<span class="op">=</span><span class="st">"blue"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="nhs-covid-app">NHS COVID app<a class="anchor" aria-label="anchor" href="#nhs-covid-app"></a>
</h2>
<p>The NHS COVID-19 app performed digital contact tracing. The rate of
venue check-ins demonstrates the levels of high risk social contacts
however it became optional from Aug 2021. Self isolation alerts peaked
in Aug / Sept 2021 during the Delta wave and again in Dec 2021 / Jan
2022 in the Omicron wave. Periods of rapid growth precede increases in
the NHS app notifications. (N.B. data from <a href="https://www.gov.uk/government/publications/nhs-covid-19-app-statistics" class="external-link uri">https://www.gov.uk/government/publications/nhs-covid-19-app-statistics</a>)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_incidence.html">plot_incidence</a></span><span class="op">(</span><span class="va">fit</span>,events <span class="op">=</span> <span class="va">england_events</span>, colour<span class="op">=</span><span class="st">"blue"</span>, date_breaks<span class="op">=</span><span class="st">"3 months"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2023-07-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="st">"Cases"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x.bottom <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/scale_y_log1p.html">scale_y_log1p</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_growth_rate.html">plot_growth_rate</a></span><span class="op">(</span><span class="va">fit</span>,events <span class="op">=</span> <span class="va">england_events</span>, colour<span class="op">=</span><span class="st">"blue"</span>, date_breaks<span class="op">=</span><span class="st">"3 months"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2023-07-01"</span><span class="op">)</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span>,<span class="fl">0.15</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">england_consensus_growth_rate</span>,<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span><span class="op">-</span><span class="fl">21</span>,ymin<span class="op">=</span><span class="va">low</span>,ymax<span class="op">=</span><span class="va">high</span><span class="op">)</span>,colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="st">"Growth rate"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x.bottom <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x.top <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_nhs_app.html">england_nhs_app</a></span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_events.html">geom_events</a></span><span class="op">(</span>events<span class="op">=</span><span class="va">england_events</span>,hide_labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">alerts</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">alerts</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,colour<span class="op">=</span><span class="st">"alerts"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">visits</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">visits</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,colour<span class="op">=</span><span class="st">"venue visits"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="va">date</span>,xmax<span class="op">=</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, ymin<span class="op">=</span><span class="fl">0</span>, ymax<span class="op">=</span><span class="va">alerts</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">alerts</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,fill<span class="op">=</span><span class="st">"alerts"</span><span class="op">)</span>, linewidth<span class="op">=</span><span class="fl">0</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="va">date</span>,xmax<span class="op">=</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, ymin<span class="op">=</span><span class="fl">0</span>, ymax<span class="op">=</span><span class="va">visits</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">visits</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,fill<span class="op">=</span><span class="st">"venue visits"</span><span class="op">)</span>, linewidth<span class="op">=</span><span class="fl">0</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>,<span class="st">"2023-07-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"relative frequency"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="st">"NHS app"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Dark2"</span>, name<span class="op">=</span><span class="cn">NULL</span>, aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>,<span class="st">"colour"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks<span class="op">=</span><span class="st">"3 months"</span>,date_labels <span class="op">=</span> <span class="st">"%b %y"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span><span class="op">+</span><span class="va">p2</span><span class="op">+</span><span class="va">p3</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="covid-timeseries_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<p>The weekly alerts data can be also modelled as a poisson process
after which it can be converted to a daily timeseries and aligned to the
incidence and growth rate data. With a fully aligned and modelled data
set we can test for granger causality:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alerts</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_nhs_app.html">england_nhs_app</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>count <span class="op">=</span> <span class="va">alerts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/poisson_locfit_model.html">poisson_locfit_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/rescale_model.html">rescale_model</a></span><span class="op">(</span><span class="st">"1 day"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">fit</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"growth"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"incidence"</span><span class="op">)</span>, .fn <span class="op">=</span> <span class="op">~</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">.x</span>,<span class="st">"incidence"</span>,<span class="st">"alert"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">fit</span>, by<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/grangertest.html" class="external-link">grangertest</a></span><span class="op">(</span><span class="va">alert.0.5</span> <span class="op">~</span> <span class="va">growth.0.5</span>, order <span class="op">=</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">alerts</span><span class="op">)</span></span>
<span><span class="co">#&gt; Granger causality test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: alert.0.5 ~ Lags(alert.0.5, 1:1) + Lags(growth.0.5, 1:1)</span></span>
<span><span class="co">#&gt; Model 2: alert.0.5 ~ Lags(alert.0.5, 1:1)</span></span>
<span><span class="co">#&gt;   Res.Df Df      F    Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; 1    947                        </span></span>
<span><span class="co">#&gt; 2    948 -1 281.93 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/grangertest.html" class="external-link">grangertest</a></span><span class="op">(</span><span class="va">growth.0.5</span> <span class="op">~</span> <span class="va">alert.0.5</span>, order <span class="op">=</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">alerts</span><span class="op">)</span></span>
<span><span class="co">#&gt; Granger causality test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: growth.0.5 ~ Lags(growth.0.5, 1:1) + Lags(alert.0.5, 1:1)</span></span>
<span><span class="co">#&gt; Model 2: growth.0.5 ~ Lags(growth.0.5, 1:1)</span></span>
<span><span class="co">#&gt;   Res.Df Df      F  Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; 1    947                    </span></span>
<span><span class="co">#&gt; 2    948 -1 4.1647 0.04155 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span></span>
<span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/grangertest.html" class="external-link">grangertest</a></span><span class="op">(</span><span class="va">incidence.0.5</span> <span class="op">~</span> <span class="va">alert.0.5</span>, order <span class="op">=</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">alerts</span><span class="op">)</span></span>
<span><span class="co">#&gt; Granger causality test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: incidence.0.5 ~ Lags(incidence.0.5, 1:1) + Lags(alert.0.5, 1:1)</span></span>
<span><span class="co">#&gt; Model 2: incidence.0.5 ~ Lags(incidence.0.5, 1:1)</span></span>
<span><span class="co">#&gt;   Res.Df Df      F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; 1    947                 </span></span>
<span><span class="co">#&gt; 2    948 -1 1.8558 0.1734</span></span>
<span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/grangertest.html" class="external-link">grangertest</a></span><span class="op">(</span><span class="va">alert.0.5</span> <span class="op">~</span> <span class="va">incidence.0.5</span>, order <span class="op">=</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">alerts</span><span class="op">)</span></span>
<span><span class="co">#&gt; Granger causality test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: alert.0.5 ~ Lags(alert.0.5, 1:1) + Lags(incidence.0.5, 1:1)</span></span>
<span><span class="co">#&gt; Model 2: alert.0.5 ~ Lags(alert.0.5, 1:1)</span></span>
<span><span class="co">#&gt;   Res.Df Df      F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; 1    947                 </span></span>
<span><span class="co">#&gt; 2    948 -1 1.2816 0.2579</span></span></code></pre></div>
<p>The conclusion of this test would be that growth is more predictive
of alerts rather than vice versa.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
