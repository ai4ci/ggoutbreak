<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Population comparisons and incidence • ggoutbreak</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Population comparisons and incidence">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggoutbreak</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ggoutbreak.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/covid-timeseries.html">England COVID-19 cases</a></li>
    <li><a class="dropdown-item" href="../articles/estimators-example.html">Simulation tests for growth rate estimators</a></li>
    <li><a class="dropdown-item" href="../articles/incidence-trends.html">Population comparisons and incidence</a></li>
    <li><a class="dropdown-item" href="../articles/infectivity-profile-discretisation.html">Infectivity profile discretisation</a></li>
    <li><a class="dropdown-item" href="../articles/right-censoring.html">Estimating the reproduction number from right censored data</a></li>
    <li><a class="dropdown-item" href="../articles/rt-from-incidence.html">Estimating the reproduction number from modelled incidence</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-serial-interval.html">Sampling the infectivity profile from published serial interval estimates</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-test-models.html">Simulations and test harnesses</a></li>
    <li><a class="dropdown-item" href="../articles/time-periods.html">Data wrangling and working with `ggoutbreak`</a></li>
    <li><a class="dropdown-item" href="../articles/variant-proportions.html">Multinomial proportions models for genomic variants</a></li>
    <li><a class="dropdown-item" href="../articles/weekly-incidence.html">Estimating the reproduction number from weekly data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/ggoutbreak/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Population comparisons and incidence</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/ggoutbreak/blob/HEAD/vignettes/incidence-trends.Rmd" class="external-link"><code>vignettes/incidence-trends.Rmd</code></a></small>
      <div class="d-none name"><code>incidence-trends.Rmd</code></div>
    </div>

    
    
<p>Comparisons between epidemic states in different populations
separated by for example geography, or in this case age, requires a
normalisation by the population size in either absolute or proportional
terms. Based on the 2021 census we have some demo data for the
demographics of England:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">england_demographics</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 19</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; Groups: class [19]</span></span>
<span><span class="co">#&gt; $ class               <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 00_04<span style="color: #949494;">, </span>05_09<span style="color: #949494;">, </span>10_14<span style="color: #949494;">, </span>15_19<span style="color: #949494;">, </span>20_24<span style="color: #949494;">, </span>25_29<span style="color: #949494;">, </span>30_34<span style="color: #949494;">, </span>3…</span></span>
<span><span class="co">#&gt; $ population          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3077000<span style="color: #949494;">, </span>3348600<span style="color: #949494;">, </span>3413100<span style="color: #949494;">, </span>3218900<span style="color: #949494;">, </span>3414400<span style="color: #949494;">, </span>37154…</span></span>
<span><span class="co">#&gt; $ baseline_proportion <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.054470107<span style="color: #949494;">, </span>0.059278063<span style="color: #949494;">, </span>0.060419864<span style="color: #949494;">, </span>0.056982069…</span></span></code></pre></div>
<div class="section level2">
<h2 id="incidence-poisson-rate-model">Incidence Poisson rate model<a class="anchor" aria-label="anchor" href="#incidence-poisson-rate-model"></a>
</h2>
<p>A plot of the normalised incidence rates of COVID-19 by population
size, shows initially the rate of COVID cases was highest in the
elderly. By late 2020 this pattern had changed and rates were uniform
across age groups. In early 2021 as vaccination took hold and school
testing was rolled out, younger age groups had higher rates of COVID
positive tests, with a curious spike in the very young age groups around
November 2021. In early 2022 the pattern reversed and the elderly again
became the age group with the highest rates, and that pattern has
persisted until the present. Transiently the instantaneous rates per
1000 person years exceeded 1000 in some age groups, this is possible for
limited time periods, or if multiple episodes per year can be
observed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tmp</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_covid.html">england_covid</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/poisson_locfit_model.html">poisson_locfit_model</a></span><span class="op">(</span>window<span class="op">=</span><span class="fl">21</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/normalise_incidence.html">normalise_incidence</a></span><span class="op">(</span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_demographics.html">england_demographics</a></span>, population_unit<span class="op">=</span><span class="fl">1000</span>, normalise_time<span class="op">=</span><span class="st">"1 year"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw_pop</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_covid.html">england_covid</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/normalise_count.html">normalise_count</a></span><span class="op">(</span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_demographics.html">england_demographics</a></span>, population_unit<span class="op">=</span><span class="fl">1000</span>, normalise_time<span class="op">=</span><span class="st">"1 year"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_incidence.html">plot_incidence</a></span><span class="op">(</span><span class="va">tmp</span>,raw <span class="op">=</span> <span class="va">raw_pop</span>, size<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/scale_y_log1p.html">scale_y_log1p</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>,<span class="st">"colour"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="incidence-trends_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>The use of test positives as a proxy for COVID incidence is clearly
potentially biased by testing (particularly in the first wave where
testing was limited to those in hospital). A more reliable comparison in
this situation would be a test positive proportion, but unfortunately
testing rates are not published broken down by age.</p>
<p>The exponential growth rate is already normalised by population size.
Comparisons of the growth rate in these populations gives an idea of how
tightly coupled they are. In most age groups the epidemic is growing and
shrinking in sync apart from possibly the very young. COVID detections
in this age group were not particularly reliable though and this would
be easy to over-interpret.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_growth_rate.html">plot_growth_rate</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>,<span class="st">"colour"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span>,<span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="incidence-trends_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>The combination of growth and normalised incidence allows us to
compare the epidemic state at different time points, in this case
Christmas day in 2020, 2021 and 2022. This shows the same data as the
previous graphs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_growth_phase.html">plot_growth_phase</a></span><span class="op">(</span><span class="va">tmp</span>,</span>
<span>    timepoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xmas 2020"</span><span class="op">=</span><span class="st">"2020-12-25"</span>,<span class="st">"Xmas 2021"</span><span class="op">=</span><span class="st">"2021-12-25"</span>,<span class="st">"Xmas 2022"</span><span class="op">=</span><span class="st">"2022-12-25"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    duration <span class="op">=</span> <span class="fl">70</span>, </span>
<span>    interval <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="incidence-trends_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="proportion-model">Proportion model<a class="anchor" aria-label="anchor" href="#proportion-model"></a>
</h2>
<p>There are two possible proportions models which would be of interest
here. As mentioned about the proportion of positive tests in each age
group would give us a clearer picture of whether the differences between
age groups are down to differential testing, but unfortunately not
available in this data set.</p>
<p>The second potential use is the distribution of ages in the test
positive age group. This age distribution gives us some information
about where the burden of disease is in the population but is also
biased by test prioritisation.</p>
<p>A multinomial proportion shows similar patterns as the normalised
incidence plot above:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">tmp2</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_covid.html">england_covid</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/proportion_locfit_model.html">proportion_locfit_model</a></span><span class="op">(</span>window<span class="op">=</span><span class="fl">21</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_multinomial.html">plot_multinomial</a></span><span class="op">(</span><span class="va">tmp2</span>,normalise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">england_demographics</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"baseline"</span>,y<span class="op">=</span><span class="va">population</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,fill<span class="op">=</span><span class="va">class</span><span class="op">)</span>, stat<span class="op">=</span><span class="st">"identity"</span>, position<span class="op">=</span><span class="st">"stack"</span>, colour<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>guide<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>expand<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span><span class="op">+</span><span class="va">p2</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">1</span>,widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">1</span><span class="op">)</span>,guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="incidence-trends_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>The age distribution of test positives can be normalised by the age
distribution of the population. This give us a relative proportion of
age groups in people testing positive versus expected in the population.
This is conceptually a relative risk but of age group given COVID
status</p>
<p>i.e. it is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mi>g</mi><mi>e</mi><mo>=</mo><mn>80</mn><mo>+</mo><mo stretchy="false" form="prefix">|</mo><mi>C</mi><mi>O</mi><mi>V</mi><mi>I</mi><mi>D</mi><mo>+</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mi>g</mi><mi>e</mi><mo>=</mo><mn>80</mn><mo>+</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><annotation encoding="application/x-tex">\frac{P(age = 80+|COVID+)}{P(age = 80+)}</annotation></semantics></math></p>
<p>At any point in time for a given population this quantity is centred
around 1 and comparing it to growth rate gives us a possibly clearer
picture of the trajectory of the relative distribution of COVID in the
population. In Xmas 2021 although the majority of cases was in the
young, relatively high growth in the elderly population meant that they
were catching up, and from above we can see that by early 2022 the
elderly had highest COVID positive rates. In 2022 however, the
separation of the age groups was established and the trajectories were
acting to preserve that separation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tmp3</span> <span class="op">=</span> <span class="va">tmp2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/infer_risk_ratio.html">infer_risk_ratio</a></span><span class="op">(</span><span class="va">england_demographics</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_growth_phase.html">plot_growth_phase</a></span><span class="op">(</span><span class="va">tmp3</span>,</span>
<span>    timepoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xmas 2020"</span><span class="op">=</span><span class="st">"2020-12-25"</span>,<span class="st">"Xmas 2021"</span><span class="op">=</span><span class="st">"2021-12-25"</span>,<span class="st">"Xmas 2022"</span><span class="op">=</span><span class="st">"2022-12-25"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    duration <span class="op">=</span> <span class="fl">70</span>, </span>
<span>    interval <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="incidence-trends_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<div class="section level3">
<h3 id="pre-test-probability">Pre test probability<a class="anchor" aria-label="anchor" href="#pre-test-probability"></a>
</h3>
<p>Using the ONS COVID-19 infection survey we can look at population
prevalence based on random sampling (panel A).</p>
<p>The proportion of people positive in a random sample of the
population can be compared to the proportion of people testing positive
out of all the people tested. This ratio is an indication of the
pre-test probability of disease in the non-random sample group and gives
us some idea of how selectively testing is being applied. If testing is
only being done on people with symptoms for example then their pre-test
probability of disease is higher than the general population. This is
shown in panel B, and it also can be interpreted as how biased the
sample that is tested for symptoms is.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_prevalence.html">plot_prevalence</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_ons_infection_survey.html">england_ons_infection_survey</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geography</span> <span class="op">==</span> <span class="st">"England"</span><span class="op">)</span>,</span>
<span>    events <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_events.html">england_events</a></span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    axis.text.x.bottom <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"ONS prevalence (%)"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_covid_pcr_positivity.html">england_covid_pcr_positivity</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/proportion_locfit_model.html">proportion_locfit_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_ons_infection_survey.html">england_ons_infection_survey</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geography</span><span class="op">==</span><span class="st">"England"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"prevalence"</span><span class="op">)</span>, .fn <span class="op">=</span> <span class="op">~</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">.x</span>,<span class="st">"prevalence"</span>,<span class="st">"ons"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">date</span>, pre_test_odds <span class="op">=</span> <span class="va">proportion.0.5</span> <span class="op">/</span> <span class="va">ons.0.5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>,y<span class="op">=</span><span class="va">pre_test_odds</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, colour<span class="op">=</span><span class="st">"grey40"</span>,linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Pre-test odds ratio"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/geom_events.html">geom_events</a></span><span class="op">(</span>events <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_events.html">england_events</a></span>,hide_labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    axis.text.x.bottom <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    axis.text.x.top <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Likewise the incidence of cases per capita can be compared to the
prevalence. A prevalence-like estimate can be made from the incidence by
convolving the incidence estimate with a delay distribution that
represents the duration of infection. Duration of infection could be
represented either by the sensitivity of a test to detect an infection
as a function of time after infection, or as the probability of
successful viral culture as a function of time after symptom onset.</p>
<p>In this case the ratio of prevalence derived from positive case
counts, resulting from symptomatic testing, and prevalence measured
directly on a random sample by the ONS survey has a connection with the
ascertainment rate. The actual value of the ascertainment rate
calculated by this method depends very heavily on assumptions on the
duration of infection, and hence the prevalence that is derived from
case rates, and absolute value of the derived ascertainment is not
reliable, however the relative change in this number is still
informative and demonstrates that case ascertainment fell abruptly
during the omicron wave (panel C).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">england_pop</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_demographics.html">england_demographics</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_covid_pcr_positivity.html">england_covid_pcr_positivity</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/poisson_locfit_model.html">poisson_locfit_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># N.B. `covid_viral_shedding` is technically from symptom onset not infection.</span></span>
<span>  <span class="co"># We could argue that this is a good thing as case positivity is closer in time</span></span>
<span>  <span class="co"># to symptom onset however this is forgetting about all the cases that would</span></span>
<span>  <span class="co"># test positive if they had been tested. An alternative to this would have been </span></span>
<span>  <span class="co"># to use `covid_test_sensitivity` which looks at probability of detection from </span></span>
<span>  <span class="co"># time of infection but it is only in cases with proven infection so a biased </span></span>
<span>  <span class="co"># prior.</span></span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/infer_prevalence.html">infer_prevalence</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="va">england_pop</span>, ip <span class="op">=</span> <span class="va">covid_viral_shedding</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">england_ons_infection_survey</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geography</span><span class="op">==</span><span class="st">"England"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"prevalence"</span><span class="op">)</span>, .fn <span class="op">=</span> <span class="op">~</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">.x</span>,<span class="st">"prevalence"</span>,<span class="st">"ons"</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">date</span>, ascertainment <span class="op">=</span> <span class="va">prevalence.0.5</span> <span class="op">/</span> <span class="va">ons.0.5</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>,y<span class="op">=</span><span class="va">ascertainment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Ascertainment rate (%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/geom_events.html">geom_events</a></span><span class="op">(</span>events <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="va"><a href="../reference/england_events.html">england_events</a></span>,hide_labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span><span class="op">+</span><span class="va">p2</span><span class="op">+</span><span class="va">p3</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_levels<span class="op">=</span><span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<p><img src="incidence-trends_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
