<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multinomial proportions models for genomic variants • growthrates</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multinomial proportions models for genomic variants">
<meta property="og:description" content="growthrates">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">growthrates</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/covid-timeseries.html">England COVID-19 cases</a>
    </li>
    <li>
      <a href="../articles/estimators-example.html">Simulation tests for growth rate estimators</a>
    </li>
    <li>
      <a href="../articles/incidence-trends.html">Population comparisons and incidence</a>
    </li>
    <li>
      <a href="../articles/time-periods.html">Data wrangling and working with `growthrates`</a>
    </li>
    <li>
      <a href="../articles/variant-proportions.html">Multinomial proportions models for genomic variants</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bristol-vaccine-centre/growthrates/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multinomial proportions models for genomic
variants</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bristol-vaccine-centre/growthrates/blob/HEAD/vignettes/variant-proportions.Rmd" class="external-link"><code>vignettes/variant-proportions.Rmd</code></a></small>
      <div class="hidden name"><code>variant-proportions.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="covid-19-proportions-in-england">COVID-19 proportions in England<a class="anchor" aria-label="anchor" href="#covid-19-proportions-in-england"></a>
</h2>
<p>The Sanger Centre &amp; COGUK performed a large amount of sequencing
of COVID-19 during the pandemic, to identify emerging genomic variants.
This was scaled up in the second half of 2021 and continued through to
the beginning of 2023. Lineages were assigned using the Pango lineage
system and important ones given nicknames by the WHO.</p>
<p>The Sanger variants data has been discontinued, but were still
available for download. The code to download, process these data sets
and determine the full lineage is in the
<code>data-raw/variants.R</code> file, but the output of this has been
bundled as a data set here. There are many caveats to the data here in
terms of bias and it should not be regarded as definitive:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tidy copy of the sanger weekly variants count data aggregated to England level</span></span>
<span><span class="fu">growthrates</span><span class="fu">::</span><span class="va"><a href="../reference/england_variants.html">england_variants</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 479</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## Groups: class [10]</span></span>
<span><span class="co">## $ date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-09-05, 2020-09-05, 2020-09-12, 2020-09-12, 2020-09-19,…</span></span>
<span><span class="co">## $ time      <span style="color: #949494; font-style: italic;">&lt;time_prd&gt;</span> 0, 0, 7, 7, 14, 14, 21, 21, 28, 28, 35, 35, 42, 42, 49,…</span></span>
<span><span class="co">## $ class     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> Other, Alpha (B.1.1.7), Other, Alpha (B.1.1.7), Other, Alpha…</span></span>
<span><span class="co">## $ who_class <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> Other, Alpha, Other, Alpha, Other, Alpha, Other, Alpha, Othe…</span></span>
<span><span class="co">## $ count     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1182, 371, 1439, 588, 837, 429, 1685, 1157, 1208, 823, 1501,…</span></span>
<span><span class="co">## $ denom     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1553, 1553, 2027, 2027, 1266, 1266, 2842, 2842, 2031, 2031, …</span></span></code></pre>
<p>The data must have a <code>class</code> column defining the main
categorisation of the data (in this case it is the main pango variant).
The <code>time</code> column is a <code>time_period</code> derived from
the date (which is weekly). The other necessary column is the
<code>count</code> column which is integer counts of each
<code>class</code>. The data must be grouped by <code>class</code>.
Multiple models can be fitted simultaneously if the data is grouped by
other columns.</p>
</div>
<div class="section level2">
<h2 id="multinomial-proportions-model-">Multinomial proportions model.<a class="anchor" aria-label="anchor" href="#multinomial-proportions-model-"></a>
</h2>
<p>Genomic testing happened only in a subset of cases. The testing
effort varied significantly over time. The frequency of each variant
over time can be determined with a multinomial model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># debug(estimate_multinomial_proportion)</span></span>
<span><span class="co"># devtools::load_all()</span></span>
<span><span class="va">probs</span> <span class="op">=</span> <span class="va">england_variants</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/multinomial_nnet_model.html">multinomial_nnet_model</a></span><span class="op">(</span>window <span class="op">=</span> <span class="fl">28</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # weights:  40 (27 variable)</span></span>
<span><span class="co">## initial  value 3583520.087982 </span></span>
<span><span class="co">## iter  10 value 1562162.620103</span></span>
<span><span class="co">## iter  20 value 1380207.974679</span></span>
<span><span class="co">## iter  30 value 959088.555929</span></span>
<span><span class="co">## iter  40 value 742507.401972</span></span>
<span><span class="co">## iter  50 value 731767.878753</span></span>
<span><span class="co">## iter  60 value 729647.595800</span></span>
<span><span class="co">## iter  70 value 726795.599565</span></span>
<span><span class="co">## iter  80 value 716309.116515</span></span>
<span><span class="co">## iter  90 value 709310.968378</span></span>
<span><span class="co">## iter 100 value 707285.617997</span></span>
<span><span class="co">## final  value 707285.617997 </span></span>
<span><span class="co">## stopped after 100 iterations</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_multinomial.html">plot_multinomial</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"cividis"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variant-proportions_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="binomial-proportions-model">Binomial proportions model<a class="anchor" aria-label="anchor" href="#binomial-proportions-model"></a>
</h2>
<p>The binomial proportions are not very different to the multinomial
probabilities calculated above, but come with confidence intervals,
however the median values do not necessarily sum to 1.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs2</span> <span class="op">=</span> <span class="va">england_variants</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/proportion_locfit_model.html">proportion_locfit_model</a></span><span class="op">(</span>window <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_proportion.html">plot_proportion</a></span><span class="op">(</span><span class="va">probs2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"cividis"</span>,aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"colour"</span>,<span class="st">"fill"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variant-proportions_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The rate of change of the proportion of each individual variant
versus the others on a logistic scale can be used to work out the
exponential growth rate of one variant relative to the others. Because
this is a relative growth rate taken togehter the esimates of all
variants at a given time are centred around zero. If one variant has a
growth advantage, by definition others have a growth disadvantage
despite potentially causing a larger disease burden and having
increasing numbers in a growing epidemic.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_growth_rate.html">plot_growth_rate</a></span><span class="op">(</span><span class="va">probs2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"cividis"</span>,aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"colour"</span>,<span class="st">"fill"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variant-proportions_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The binomial relative growth rate per day is a growth advantage over
existing variants. This has a dependency on the unit of time which is
controlled by the <code>time_period</code> configuration. In the data
provided here the <code>time_period</code> is defined on a daily basis
despite the data being provided weekly. Doubling time does not make
strict sense when describing relative growth rates and is not shown
here.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
