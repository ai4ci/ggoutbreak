<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Infectivity profile discretisation • ggoutbreak</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Infectivity profile discretisation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggoutbreak</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ggoutbreak.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/covid-timeseries.html">England COVID-19 cases</a></li>
    <li><a class="dropdown-item" href="../articles/estimators-example.html">Simulation tests for growth rate estimators</a></li>
    <li><a class="dropdown-item" href="../articles/incidence-trends.html">Population comparisons and incidence</a></li>
    <li><a class="dropdown-item" href="../articles/infectivity-profile-discretisation.html">Infectivity profile discretisation</a></li>
    <li><a class="dropdown-item" href="../articles/right-censoring.html">Estimating the reproduction number from right censored data</a></li>
    <li><a class="dropdown-item" href="../articles/rt-from-incidence.html">Estimating the reproduction number from modelled incidence</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-serial-interval.html">Sampling the infectivity profile from published serial interval estimates</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-test-models.html">Simulations and test harnesses</a></li>
    <li><a class="dropdown-item" href="../articles/time-periods.html">Data wrangling and working with `ggoutbreak`</a></li>
    <li><a class="dropdown-item" href="../articles/variant-proportions.html">Multinomial proportions models for genomic variants</a></li>
    <li><a class="dropdown-item" href="../articles/weekly-incidence.html">Estimating the reproduction number from weekly data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/ggoutbreak/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Infectivity profile discretisation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/ggoutbreak/blob/HEAD/vignettes/infectivity-profile-discretisation.Rmd" class="external-link"><code>vignettes/infectivity-profile-discretisation.Rmd</code></a></small>
      <div class="d-none name"><code>infectivity-profile-discretisation.Rmd</code></div>
    </div>

    
    
<p>Estimation of the infectivity profile is usually done by fitting a
doubly censored survival model with an underlying gamma probability
distribution to data and can be done with MCMC using
<code>EpiEstim</code>. In this case we demonstrate this with a mock
Rotavirus dataset from <code>EpiEstim</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clever_init_param</span> <span class="op">&lt;-</span> <span class="fu">EpiEstim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EpiEstim/man/init_mcmc_params.html" class="external-link">init_mcmc_params</a></span><span class="op">(</span><span class="va">si_data</span>, <span class="st">"G"</span><span class="op">)</span></span>
<span><span class="va">SI_fit_clever</span> <span class="op">&lt;-</span> <span class="fu">coarseDataTools</span><span class="fu">::</span><span class="fu"><a href="http://nickreich.github.io/coarseDataTools/reference/dic.fit.mcmc.html" class="external-link">dic.fit.mcmc</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">si_data</span>,</span>
<span>  dist <span class="op">=</span> <span class="st">"G"</span>, <span class="co"># Gamma distribution</span></span>
<span>  init.pars <span class="op">=</span> <span class="va">clever_init_param</span>,</span>
<span>  burnin <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n.samples <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running 6000 MCMC iterations </span></span>
<span><span class="co">## MCMCmetrop1R iteration 1 of 6000 </span></span>
<span><span class="co">## function value =  -31.57675</span></span>
<span><span class="co">## theta = </span></span>
<span><span class="co">##    0.13231</span></span>
<span><span class="co">##    0.29055</span></span>
<span><span class="co">## Metropolis acceptance rate = 0.00000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span>
<span><span class="co">## The Metropolis acceptance rate was 0.55033</span></span>
<span><span class="co">## @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SI_fit_clever</span></span></code></pre></div>
<pre><code><span><span class="co">## Coarse Data Model Parameter and Quantile Estimates: </span></span>
<span><span class="co">##         est CIlow CIhigh</span></span>
<span><span class="co">## shape 1.079 0.457  2.298</span></span>
<span><span class="co">## scale 1.353 0.621  3.352</span></span>
<span><span class="co">## p5    0.092 0.003  0.338</span></span>
<span><span class="co">## p50   1.046 0.457  1.691</span></span>
<span><span class="co">## p95   4.228 2.730  7.446</span></span>
<span><span class="co">## p99   6.402 4.035 12.116</span></span>
<span><span class="co">## Note: please check that the MCMC converged on the target distribution by running multiple chains. MCMC samples are available in the mcmc slot (e.g. my.fit@mcmc)</span></span></code></pre>
<p>The median estimate and confidence intervals are quantiles of the
posterior samples each of which define a candidate gamma distribution.
The density of a subset of these are plotted here.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The sample quantiles</span></span>
<span><span class="co"># apply(SI_fit_clever@samples,MARGIN = 2,FUN = quantile, p=c(0.5,0.025,0.975))</span></span>
<span></span>
<span><span class="va">gammas</span> <span class="op">=</span> <span class="va">SI_fit_clever</span><span class="op">@</span><span class="va">samples</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>    rate <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">var2</span>, </span>
<span>    shape <span class="op">=</span> <span class="va">var1</span>, </span>
<span>    scale <span class="op">=</span> <span class="va">var2</span>, </span>
<span>    mean <span class="op">=</span> <span class="va">var1</span><span class="op">*</span><span class="va">var2</span>, </span>
<span>    sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span><span class="op">*</span><span class="va">var2</span>, </span>
<span>    lmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>, </span>
<span>    lsd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">max_x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">qgamma</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="va">gammas</span><span class="op">$</span><span class="va">shape</span>, <span class="va">gammas</span><span class="op">$</span><span class="va">rate</span><span class="op">)</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">si_distr</span><span class="op">)</span><span class="op">)</span> <span class="va">si_distr</span> <span class="op">=</span> <span class="fu">EpiEstim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EpiEstim/man/discr_si.html" class="external-link">discr_si</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">max_x</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gammas</span><span class="op">$</span><span class="va">mean</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gammas</span><span class="op">$</span><span class="va">sd</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap</a></span><span class="op">(</span><span class="va">gammas</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, </span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">shape</span>,<span class="va">rate</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">geom_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">x</span>, shape<span class="op">=</span><span class="va">shape</span>, rate<span class="op">=</span><span class="va">rate</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.05</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">max_x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"density"</span><span class="op">)</span></span></code></pre></div>
<p><img src="infectivity-profile-discretisation_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>Alternatives to generating these infectivity profile distributions
from data are examined in the vignette “Sampling the infectivity profile
from published serial interval estimates”, and include resampling from
published estimates.</p>
<p>Estimation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
using <code>EpiEstim</code> requires that the infectivity profile
estimates are discretised. As the underlying Cori method requires that
the probability of infection at day zero is zero, <code>EpiEstim</code>
discretises the infectivity profile distributions using a offset gamma
distribution which requires that the mean of the infectivity profile
distribution is greater than 1. This results in some MCMC fitted
distributions being unsuitable especially in this case where the mean is
short.</p>
<p>If we are using a framework for estimating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
that does not have this requirement a more natural discretisation using
the the cumulative density of the untransformed gamma distribution and
cut points based on 0.5 day intervals is possible.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">original_disc</span> <span class="op">=</span> <span class="va">gammas</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>    coll <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    disc <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">mean</span>,<span class="va">sd</span>, <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>                         a0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>,length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>,length.out <span class="op">=</span> <span class="fl">51</span><span class="op">)</span>,</span>
<span>                         p <span class="op">=</span> <span class="fu">EpiEstim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EpiEstim/man/discr_si.html" class="external-link">discr_si</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">50</span>, <span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    disc_type <span class="op">=</span> <span class="st">"discr_si"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">disc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdf_disc</span> <span class="op">=</span> <span class="va">gammas</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>      discr <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>        <span class="va">shape</span>, <span class="va">rate</span>, <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>          a0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>,length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>,length.out <span class="op">=</span> <span class="fl">51</span><span class="op">)</span>,</span>
<span>          p <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">pgamma</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">.x</span> ,<span class="va">.y</span><span class="op">)</span>,default <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">pgamma</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">.x</span> ,<span class="va">.y</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      coll <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      disc_type <span class="op">=</span> <span class="st">"cdf"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">discr</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">original_disc</span>,<span class="va">cdf_disc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>disc_type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">disc_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"discr_si"</span>,<span class="st">"cdf"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sources</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">disc_type</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_summ</span> <span class="op">=</span> <span class="va">tmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">disc_type</span>,<span class="va">a0</span>,<span class="va">a</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'source', 'a0'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmp_mean = tmp %&gt;% dplyr::group_by(source = disc_type,coll) %&gt;% </span></span>
<span><span class="co">#   dplyr::summarise(mean = sum(a*p)) %&gt;% </span></span>
<span><span class="co">#   dplyr::summarise(sd = stats::sd(mean),mean = mean(mean), parameter="mean") %&gt;%</span></span>
<span><span class="co">#   dplyr::bind_rows(</span></span>
<span><span class="co">#     gammas %&gt;% dplyr::summarise(sd = stats::sd(mean),mean=mean(mean), parameter="mean",source="none")</span></span>
<span><span class="co">#   )</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">disc_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>mapping<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">a0</span>,xend<span class="op">=</span><span class="va">a</span>,y<span class="op">=</span><span class="va">p</span>, colour<span class="op">=</span><span class="va">source</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_summ</span>, mapping<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">a0</span>,xend<span class="op">=</span><span class="va">a</span>,y<span class="op">=</span><span class="va">p</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">max_x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">source</span><span class="op">)</span></span></code></pre></div>
<p><img src="infectivity-profile-discretisation_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmp_mean</span></span></code></pre></div>
<p>This alternative discretisation will affect reproduction number
estimation. We might expect that for a given growth rate the
reproduction number would be less for the <code>cdf</code>
discretisation as the mass of the probability looks lower. This would
mean that more generations of the epidemic can be expected in a unit
time and hence any observed exponential growth per unit time is due to
fewer secondary infections per primary infection.</p>
<p>We test this with a fixed value of the growth rate, and the
Wallinga-Lipsitch method of estimating reproduction number from growth
rate, for both types of discretisation. The Wallinga-Lipsitch method can
use arbitrary limits for the discretisation of the infectivity profile
and hence can produce an estimate with infectivity profiles that are
impossible to use in <code>EpiEstim</code>. For comparison the result of
estimating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
using <code>EpiEstim</code>, and using the <code>discr_si</code>
strategy is also included.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R_t</span> <span class="op">=</span> <span class="va">tmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p</span>,<span class="va">a</span>,<span class="va">a0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="fl">0.05</span>,<span class="fl">0</span>,<span class="op">-</span><span class="fl">0.05</span>,<span class="op">-</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    R_t <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">dist</span>, <span class="op">~</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/wallinga_lipsitch.html">wallinga_lipsitch</a></span><span class="op">(</span><span class="va">.x</span>, y <span class="op">=</span> <span class="va">.y</span><span class="op">$</span><span class="va">p</span>, a0 <span class="op">=</span> <span class="va">.y</span><span class="op">$</span><span class="va">a0</span>, a <span class="op">=</span> <span class="va">.y</span><span class="op">$</span><span class="va">a</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"wall-lips (%s)"</span>,<span class="va">disc_type</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">R_t</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">R_t_summ</span> <span class="op">=</span> <span class="va">R_t</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">r</span>,<span class="va">source</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>  median <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">R_t</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">R_t</span>,<span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">R_t</span>,<span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'r'. You can override using the `.groups`</span></span>
<span><span class="co">## argument.</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="fl">0.05</span>,<span class="fl">0</span>,<span class="op">-</span><span class="fl">0.05</span>,<span class="op">-</span><span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># select a shorter list of samples</span></span>
<span><span class="va">tmp2</span> <span class="op">=</span> <span class="va">tmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">disc_type</span> <span class="op">==</span> <span class="st">"discr_si"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">disc_type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>  si_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">51</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">250</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tmp2$si_matrix[[1]][1:10,1:10]</span></span>
<span></span>
<span><span class="va">compare_R</span> <span class="op">=</span> <span class="va">tmp2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>R <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">si_matrix</span>, <span class="va">r</span>, <span class="op">~</span> <span class="op">{</span></span>
<span>  <span class="va">ts</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        t <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        I <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">.y</span><span class="op">*</span><span class="va">t</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">EpiEstim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EpiEstim/man/estimate_R.html" class="external-link">estimate_R</a></span><span class="op">(</span><span class="va">ts</span>, </span>
<span>      method<span class="op">=</span><span class="st">"si_from_sample"</span>, si_sample <span class="op">=</span> <span class="va">.x</span>,</span>
<span>      config <span class="op">=</span> <span class="fu">EpiEstim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EpiEstim/man/make_config.html" class="external-link">make_config</a></span><span class="op">(</span>t_start<span class="op">=</span><span class="fl">2</span>, t_end <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">R</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 7 warnings in `dplyr::mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `R = purrr::map2(...)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> Unknown or uninitialised column: `dates`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 6 remaining warnings.</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot2data</span> <span class="op">=</span> <span class="va">compare_R</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 7</span></span>
<span><span class="co">## Columns: 14</span></span>
<span><span class="co">## $ source              <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> discr_si<span style="color: #949494;">, </span>discr_si<span style="color: #949494;">, </span>discr_si<span style="color: #949494;">, </span>discr_si<span style="color: #949494;">, </span>discr_si<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">## $ si_matrix           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[51 x 250]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;matrix[51 x 250]&gt;&gt;<span style="color: #949494;">, </span>&lt;&lt;mat…</span></span>
<span><span class="co">## $ r                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.40<span style="color: #949494;">, </span>0.20<span style="color: #949494;">, </span>0.10<span style="color: #949494;">, </span>0.05<span style="color: #949494;">, </span>0.00<span style="color: #949494;">, </span>-0.05<span style="color: #949494;">, </span>-0.10</span></span>
<span><span class="co">## $ t_start             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2</span></span>
<span><span class="co">## $ t_end               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 30<span style="color: #949494;">, </span>30<span style="color: #949494;">, </span>30<span style="color: #949494;">, </span>30<span style="color: #949494;">, </span>30<span style="color: #949494;">, </span>30<span style="color: #949494;">, </span>30</span></span>
<span><span class="co">## $ `Mean(R)`           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.6869502<span style="color: #949494;">, </span>1.3182603<span style="color: #949494;">, </span>1.1574308<span style="color: #949494;">, </span>1.0844530<span style="color: #949494;">, </span>1.0186…</span></span>
<span><span class="co">## $ `Std(R)`            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.11178630<span style="color: #949494;">, </span>0.05272504<span style="color: #949494;">, </span>0.02853700<span style="color: #949494;">, </span>0.02154534<span style="color: #949494;">, </span>0.…</span></span>
<span><span class="co">## $ `Quantile.0.025(R)` <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.5204139<span style="color: #949494;">, </span>1.2345762<span style="color: #949494;">, </span>1.1091722<span style="color: #949494;">, </span>1.0451210<span style="color: #949494;">, </span>0.9783…</span></span>
<span><span class="co">## $ `Quantile.0.05(R)`  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.5268640<span style="color: #949494;">, </span>1.2410459<span style="color: #949494;">, </span>1.1143866<span style="color: #949494;">, </span>1.0505619<span style="color: #949494;">, </span>0.9844…</span></span>
<span><span class="co">## $ `Quantile.0.25(R)`  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.5937495<span style="color: #949494;">, </span>1.2761596<span style="color: #949494;">, </span>1.1354775<span style="color: #949494;">, </span>1.0691486<span style="color: #949494;">, </span>1.0045…</span></span>
<span><span class="co">## $ `Median(R)`         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.6720701<span style="color: #949494;">, </span>1.3109478<span style="color: #949494;">, </span>1.1547614<span style="color: #949494;">, </span>1.0834827<span style="color: #949494;">, </span>1.0186…</span></span>
<span><span class="co">## $ `Quantile.0.75(R)`  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.7803827<span style="color: #949494;">, </span>1.3637135<span style="color: #949494;">, </span>1.1793698<span style="color: #949494;">, </span>1.0990892<span style="color: #949494;">, </span>1.0323…</span></span>
<span><span class="co">## $ `Quantile.0.95(R)`  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.8822181<span style="color: #949494;">, </span>1.4086249<span style="color: #949494;">, </span>1.2053782<span style="color: #949494;">, </span>1.1210002<span style="color: #949494;">, </span>1.0531…</span></span>
<span><span class="co">## $ `Quantile.0.975(R)` <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.9120433<span style="color: #949494;">, </span>1.4212829<span style="color: #949494;">, </span>1.2135297<span style="color: #949494;">, </span>1.1280083<span style="color: #949494;">, </span>1.0601…</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">R_t_summ</span> <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">median</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, colour <span class="op">=</span> <span class="va">source</span><span class="op">)</span>, position<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">lower</span>, ymax<span class="op">=</span><span class="va">upper</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, colour <span class="op">=</span> <span class="va">source</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">0.2</span>,position<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot2data</span>, mapping<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">`Median(R)`</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"epiestim (discr_si)"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot2data</span>, mapping<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">`Quantile.0.025(R)`</span>, ymax<span class="op">=</span><span class="va">`Quantile.0.975(R)`</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"epiestim (discr_si)"</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Growth rate (days⁻¹)"</span><span class="op">)</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Reproduction number"</span><span class="op">)</span></span></code></pre></div>
<p><img src="infectivity-profile-discretisation_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>We see a noticeably less extreme estimate for the reproduction number
when the infectivity profile is discretised with the unadjusted
<code>cdf</code> strategy compared with the <code>EpiEstim</code>
inbuilt <code>discr_si</code> strategy. This is worse as the growth rate
increases, with <code>discr_si</code> based estimates being un to 20%
higher in extreme growth rate scenarios. The bias will be accentuated in
this example as it contains a very short serial interval, which makes
the discretisation error more apparent. We would expect to see much less
bias due to discretisation if dealing with diseases with longer serial
intervals.</p>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The methods involved in <code>EpiEstim</code> require that the
infectivity profile is a discrete probability distribution and that the
probability of transmission at time zero is zero. For diseases with a
shorter serial interval, these constraints are difficult to resolve, and
discretisation of the infectivity profile distribution using a offset 1
gamma distribution results in an unusual shape to the discrete
distribution. In the Wallinga-Lipsitch framework for estimating the
reproduction number from the growth rate these constraints do not apply
and we can compare <code>EpiEstim</code>s discretisation approach to one
that is closer to the originally estimated continuous distribution, but
which requires that the framework can handle a non zero probability of
transmission on day zero. This comparison suggests that discretisation
may bias <code>EpiEstim</code>s estimates of the reproduction number by
up to 20% when growth rates are high, or even higher when compared to
the equilibrium point of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_t=1</annotation></semantics></math>.
Alternative strategies for discretisation and frameworks that relax the
requirement for a probability of infection of zero at time zero will
benefit from further investigation particularly for diseases with a
shorter serial interval.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
