<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating the reproduction number from weekly data • ggoutbreak</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating the reproduction number from weekly data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggoutbreak</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ggoutbreak.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/covid-timeseries.html">England COVID-19 cases</a></li>
    <li><a class="dropdown-item" href="../articles/estimators-example.html">Simulation tests for growth rate estimators</a></li>
    <li><a class="dropdown-item" href="../articles/incidence-trends.html">Population comparisons and incidence</a></li>
    <li><a class="dropdown-item" href="../articles/infectivity-profile-discretisation.html">Infectivity profile discretisation</a></li>
    <li><a class="dropdown-item" href="../articles/right-censoring.html">Estimating the reproduction number from right censored data</a></li>
    <li><a class="dropdown-item" href="../articles/rt-from-incidence.html">Estimating the reproduction number from modelled incidence</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-serial-interval.html">Sampling the infectivity profile from published serial interval estimates</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-test-models.html">Simulations and test harnesses</a></li>
    <li><a class="dropdown-item" href="../articles/time-periods.html">Data wrangling and working with `ggoutbreak`</a></li>
    <li><a class="dropdown-item" href="../articles/variant-proportions.html">Multinomial proportions models for genomic variants</a></li>
    <li><a class="dropdown-item" href="../articles/weekly-incidence.html">Estimating the reproduction number from weekly data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/ggoutbreak/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimating the reproduction number from weekly data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/ggoutbreak/blob/HEAD/vignettes/weekly-incidence.Rmd" class="external-link"><code>vignettes/weekly-incidence.Rmd</code></a></small>
      <div class="d-none name"><code>weekly-incidence.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>It is common for epidemic data to be aggregated into weekly, monthly
or even yearly case counts, for example the result of batching in
reporting processes. <code>ggoutbreak</code> has a set of infrastructure
to allow case counts to be used to estimate the reproduction number,
regardless of their periodicity.</p>
</div>
<div class="section level2">
<h2 id="simulation-with-weekly-data">Simulation with weekly data<a class="anchor" aria-label="anchor" href="#simulation-with-weekly-data"></a>
</h2>
<p>We construct a very simple count model based on a time-varying growth
rate which is specified as an exponential growth in case counts per
week. The <code>time_unit</code> is defined here as 1 week, but this
would typically be determined by the data. <code>ggoutbreak</code> will
generally make an informed guess at the periodicity of data when we
construct a <code>time_period</code> column from dates, if it is not
stated.</p>
<p>In this case the simulation generates an outbreak over the course of
one year with a maximum number of weekly cases around 250, resulting
from an initial import of 30 infectious cases in week 0.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">changes</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">t</span>,    <span class="op">~</span><span class="va">r</span>,</span>
<span>  <span class="fl">0</span>,      <span class="fl">0</span>,</span>
<span>  <span class="fl">5</span>,     <span class="fl">0.2</span>,</span>
<span>  <span class="fl">10</span>,     <span class="fl">0.1</span>,</span>
<span>  <span class="fl">20</span>,     <span class="fl">0</span>,</span>
<span>  <span class="fl">25</span>,     <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>  <span class="fl">35</span>,     <span class="op">-</span><span class="fl">0.05</span>,</span>
<span>  <span class="fl">45</span>,     <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">sim</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_poisson_model.html">sim_poisson_model</a></span><span class="op">(</span></span>
<span>  changes <span class="op">=</span> <span class="va">changes</span>,</span>
<span>  max_time <span class="op">=</span> <span class="fl">52</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="st">"1 week"</span>,</span>
<span>  fn_imports <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.x</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">30</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  seed<span class="op">=</span><span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">events</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">sim</span>,<span class="st">"events"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_cases.html">plot_cases</a></span><span class="op">(</span><span class="va">sim</span>, events <span class="op">=</span> <span class="va">events</span>, colour<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span></code></pre></div>
<p><img src="weekly-incidence_files/figure-html/unnamed-chunk-1-1.png" width="576"></p>
<p>We can go ahead and model the case rate and exponential growth rate
using a poisson model and plot them, with the parametrised growth rate
in red. In this case the time unit for both rates is per week. Although
the time unit is per week, the model output is creating an estimate per
day (controlled by the <code>frequency</code> parameter here), to allow
the smooth plot.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Estimate weekly incidence and weekly exponential growth rate</span></span>
<span><span class="va">incidence</span> <span class="op">=</span> <span class="va">sim</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="../reference/poisson_locfit_model.html">poisson_locfit_model</a></span><span class="op">(</span>frequency <span class="op">=</span> <span class="st">"1 day"</span>,deg <span class="op">=</span> <span class="fl">2</span>, window<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_incidence.html">plot_incidence</a></span><span class="op">(</span><span class="va">incidence</span>, events<span class="op">=</span><span class="va">events</span>, raw <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_growth_rate.html">plot_growth_rate</a></span><span class="op">(</span><span class="va">incidence</span>,events <span class="op">=</span> <span class="va">events</span><span class="op">)</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span><span class="op">*</span><span class="fl">7</span>,<span class="op">+</span><span class="fl">0.05</span><span class="op">*</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># The simulation data includes the parametrised growth rate:</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sim</span>, mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, y<span class="op">=</span><span class="va">growth</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="va">p1</span><span class="op">+</span><span class="va">p2</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">1</span>,axes<span class="op">=</span><span class="st">"collect"</span><span class="op">)</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<p><img src="weekly-incidence_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>We want to estimate the reproduction number, and for this our methods
need estimates of the daily incidence of cases, as input to the renewal
equation. To do this we rescale the temporal dimension of the model
(using <code><a href="../reference/rescale_model.html">rescale_model()</a></code>) and we replot it. In this plot the
daily case rate is estimated to peak at just over 30 (= 250/7 approx).
The growth rate is also rescaled to account for the fact that the
exponential growth rate per day is compounded up in the per week figures
above.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Rescale weekly to daily incidence estimates</span></span>
<span><span class="va">incidence2</span> <span class="op">=</span> <span class="va">incidence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/rescale_model.html">rescale_model</a></span><span class="op">(</span>time_unit <span class="op">=</span> <span class="st">"1 day"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_incidence.html">plot_incidence</a></span><span class="op">(</span><span class="va">incidence2</span>, events<span class="op">=</span><span class="va">events</span>, raw <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_growth_rate.html">plot_growth_rate</a></span><span class="op">(</span><span class="va">incidence2</span>,events <span class="op">=</span> <span class="va">events</span><span class="op">)</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="op">+</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span><span class="op">+</span><span class="va">p2</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">1</span>,axes <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span><span class="op">+</span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_level<span class="op">=</span><span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<p><img src="weekly-incidence_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>From this we can easily use our incidence estimates and an generation
time distribution to estimate the reproduction number for this
time-series. To compare it we use a different method (Wallinga-Lipsitch
2007) to convert the growth rate parametrisation direct to an equivalent
reproduction number. We see good agreement, and the uncertainty
associated with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
estimates derived from weekly count data is appropriately large, and
include uncertainty in the generation time.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Convert weekly growth rate input to simulation to a reproduction number</span></span>
<span><span class="co"># and ensure time scales align.</span></span>
<span><span class="va">changes2</span> <span class="op">=</span> <span class="va">changes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="va">t</span><span class="op">*</span><span class="fl">7</span>,</span>
<span>  R <span class="op">=</span> <span class="fu"><a href="../reference/wallinga_lipsitch.html">wallinga_lipsitch</a></span><span class="op">(</span><span class="va">r</span><span class="op">/</span><span class="fl">7</span>, <span class="va">ganyani_ip_2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rt_for_date</span> <span class="op">=</span> \<span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu"><a href="../reference/cfg_step_fn.html">cfg_step_fn</a></span><span class="op">(</span><span class="va">changes2</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="va">t</span>, unit<span class="op">=</span><span class="st">"1 day"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the reproduction number from daily incidence estimates</span></span>
<span><span class="va">rt_estim</span> <span class="op">=</span> <span class="va">incidence2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/rt_from_incidence.html">rt_from_incidence</a></span><span class="op">(</span>ip <span class="op">=</span> <span class="va">ganyani_ip_2</span>,approx <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_rt.html">plot_rt</a></span><span class="op">(</span><span class="va">rt_estim</span>,events <span class="op">=</span> <span class="va">events</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">geom_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">rt_for_date</span>,colour<span class="op">=</span><span class="st">"red"</span>,n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rt_estim</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="weekly-incidence_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
