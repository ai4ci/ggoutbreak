<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data wrangling and working with `ggoutbreak` • ggoutbreak</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data wrangling and working with `ggoutbreak`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggoutbreak</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ggoutbreak.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/covid-timeseries.html">England COVID-19 cases</a></li>
    <li><a class="dropdown-item" href="../articles/estimators-example.html">Simulation tests for growth rate estimators</a></li>
    <li><a class="dropdown-item" href="../articles/incidence-trends.html">Population comparisons and incidence</a></li>
    <li><a class="dropdown-item" href="../articles/infectivity-profile-discretisation.html">Infectivity profile discretisation</a></li>
    <li><a class="dropdown-item" href="../articles/rt-from-incidence.html">Estimating the reproduction number from modelled incidence</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-serial-interval.html">Sampling the infectivity profile from published serial interval estimates</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-test-models.html">Simulations and test harnesses</a></li>
    <li><a class="dropdown-item" href="../articles/time-periods.html">Data wrangling and working with `ggoutbreak`</a></li>
    <li><a class="dropdown-item" href="../articles/variant-proportions.html">Multinomial proportions models for genomic variants</a></li>
    <li><a class="dropdown-item" href="../articles/weekly-incidence.html">Estimating the reproduction number from weekly data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/ggoutbreak/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data wrangling and working with `ggoutbreak`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/ggoutbreak/blob/HEAD/vignettes/time-periods.Rmd" class="external-link"><code>vignettes/time-periods.Rmd</code></a></small>
      <div class="d-none name"><code>time-periods.Rmd</code></div>
    </div>

    
    
<p><code>ggoutbreak</code> assumes a consistent naming scheme for
significant columns, notably <code>time</code> and <code>count</code>,
and additionally <code>class</code>, <code>denom</code>,
<code>population</code> columns. Data needs to be supplied using these
column names and to make sure the data is formatted correctly it
undergoes quite rigorous checks. One area where this can pose problems
is in correct grouping, which must make sure that each group is a single
time series of unique <code>time</code> and minimally <code>count</code>
columns.</p>
<div class="section level2">
<h2 id="line-lists-vs--time-series">Line lists vs. time series<a class="anchor" aria-label="anchor" href="#line-lists-vs--time-series"></a>
</h2>
<p>Infectious disease data usually either comes as a set of observations
of an individual infection with a time stamp (i.e. a line list) or as a
count of events (e.g. positive tests, hospitalisations, deaths)
happening within a specific period (day, week, month etc.) as a time
series.</p>
<p>For count data there may also be a denominator known. For testing
this could be the number of tests performed, or the number of patients
at risk of hospitalisation.</p>
<p>For both these data types there may also be a class associated with
each observation, defining a subgroup of infections of interest. This
could be the variant of a virus, or the age group, for example. It may
make sense to compare these different subgroups against each other. In
this case the denominator may be the total of counts among all groups
per unit time. Additionally there may be information about the size of
the population for each subgroup.</p>
<p><code>ggoutbreak</code> assumes for the most part that the input data
is in the form of a set of time series of counts, each of which has a
unique set of times, which are usually complete. To create datasets like
this from line lists <code>ggoutbreak</code> provides some
infrastructure for dealing with time series:</p>
</div>
<div class="section level2">
<h2 id="time-periods">Time periods<a class="anchor" aria-label="anchor" href="#time-periods"></a>
</h2>
<p>A weekly case rate represents a time slice of seven days with a start
and finish date. Dates are a continuous quantity, and
<code>cut_dates()</code> can be used to classify continuous dates into
periods of equal duration, with a start date:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">21</span>,<span class="fl">50</span>,replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cut_date.html">cut_date</a></span><span class="op">(</span> <span class="va">random_dates</span>, unit <span class="op">=</span> <span class="st">"1 week"</span>, anchor <span class="op">=</span> <span class="st">"start"</span>, dfmt <span class="op">=</span> <span class="st">"%d %b"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 24 Aug — 30 Aug 24 Aug — 30 Aug 17 Aug — 23 Aug 17 Aug — 23 Aug 31 Aug — 06 Sep </span></span>
<span><span class="co">#&gt;    "2025-08-24"    "2025-08-24"    "2025-08-17"    "2025-08-17"    "2025-08-31" </span></span>
<span><span class="co">#&gt; 31 Aug — 06 Sep 17 Aug — 23 Aug 17 Aug — 23 Aug 24 Aug — 30 Aug 17 Aug — 23 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-31"    "2025-08-17"    "2025-08-17"    "2025-08-24"    "2025-08-17" </span></span>
<span><span class="co">#&gt; 17 Aug — 23 Aug 31 Aug — 06 Sep 24 Aug — 30 Aug 17 Aug — 23 Aug 24 Aug — 30 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-17"    "2025-08-31"    "2025-08-24"    "2025-08-17"    "2025-08-24" </span></span>
<span><span class="co">#&gt; 24 Aug — 30 Aug 17 Aug — 23 Aug 31 Aug — 06 Sep 24 Aug — 30 Aug 17 Aug — 23 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-24"    "2025-08-17"    "2025-08-31"    "2025-08-24"    "2025-08-17" </span></span>
<span><span class="co">#&gt; 17 Aug — 23 Aug 17 Aug — 23 Aug 31 Aug — 06 Sep 17 Aug — 23 Aug 17 Aug — 23 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-17"    "2025-08-17"    "2025-08-31"    "2025-08-17"    "2025-08-17" </span></span>
<span><span class="co">#&gt; 24 Aug — 30 Aug 17 Aug — 23 Aug 31 Aug — 06 Sep 17 Aug — 23 Aug 24 Aug — 30 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-24"    "2025-08-17"    "2025-08-31"    "2025-08-17"    "2025-08-24" </span></span>
<span><span class="co">#&gt; 24 Aug — 30 Aug 31 Aug — 06 Sep 17 Aug — 23 Aug 31 Aug — 06 Sep 31 Aug — 06 Sep </span></span>
<span><span class="co">#&gt;    "2025-08-24"    "2025-08-31"    "2025-08-17"    "2025-08-31"    "2025-08-31" </span></span>
<span><span class="co">#&gt; 17 Aug — 23 Aug 17 Aug — 23 Aug 17 Aug — 23 Aug 31 Aug — 06 Sep 24 Aug — 30 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-17"    "2025-08-17"    "2025-08-17"    "2025-08-31"    "2025-08-24" </span></span>
<span><span class="co">#&gt; 17 Aug — 23 Aug 31 Aug — 06 Sep 31 Aug — 06 Sep 17 Aug — 23 Aug 24 Aug — 30 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-17"    "2025-08-31"    "2025-08-31"    "2025-08-17"    "2025-08-24" </span></span>
<span><span class="co">#&gt; 17 Aug — 23 Aug 24 Aug — 30 Aug 31 Aug — 06 Sep 31 Aug — 06 Sep 24 Aug — 30 Aug </span></span>
<span><span class="co">#&gt;    "2025-08-17"    "2025-08-24"    "2025-08-31"    "2025-08-31"    "2025-08-24"</span></span></code></pre></div>
<p>Performing calculations using interval censored dates is awkward. A
numeric version of dates is useful that can keep track of both the start
date of a time series and its intrinsic duration, as a numeric. This is
the purpose of the <code>time_period</code> class:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">7</span>,length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span>
<span><span class="va">tmp</span></span>
<span><span class="co">#&gt; time unit: week, origin: 2019-12-29 (a Sunday)</span></span>
<span><span class="co">#&gt; [1] 0.4285714 1.4285714 2.4285714 3.4285714 4.4285714</span></span></code></pre></div>
<p>The <code>time_period</code> defaults to using a date at the
beginning of the COVID-19 pandemic as its origin and calculating a
duration unit based on the data (in this case weekly).</p>
<p>A usual set of S3 methods are available such as formatting, printing,
labelling, and casting <code>time_period</code>s to and from dates and
<code>POSIXct</code> classes:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/labels.html" class="external-link">labels</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "01/Jan — 08/Jan" "08/Jan — 15/Jan" "15/Jan — 22/Jan" "22/Jan — 29/Jan"</span></span>
<span><span class="co">#&gt; [5] "29/Jan — 05/Feb"</span></span></code></pre></div>
<p>A weekly time series can be recast to a different frequency, or start
date:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tmp2</span> <span class="op">=</span> <span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="va">tmp</span>, unit <span class="op">=</span> <span class="st">"2 days"</span>, start_date <span class="op">=</span> <span class="st">"2020-01-01"</span><span class="op">)</span></span>
<span><span class="va">tmp2</span></span>
<span><span class="co">#&gt; time unit: 2 days, origin: 2020-01-01 (a Wednesday)</span></span>
<span><span class="co">#&gt; [1]  0.0  3.5  7.0 10.5 14.0</span></span></code></pre></div>
<p>and the original dates should be recoverable:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">tmp2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-01-01" "2020-01-08" "2020-01-15" "2020-01-22" "2020-01-29"</span></span></code></pre></div>
<p><code><a href="../reference/date_seq.html">date_seq()</a></code> can be used to make sure a set of periodic
times is complete:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tmp3</span> <span class="op">=</span> <span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">*</span><span class="fl">7</span>,anchor <span class="op">=</span> <span class="st">"start"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="../reference/date_seq.html">date_seq</a></span><span class="op">(</span><span class="va">tmp3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2025-08-16" "2025-08-23" "2025-08-30" "2025-09-06" "2025-09-13"</span></span>
<span><span class="co">#&gt; [6] "2025-09-20"</span></span></code></pre></div>
<p><code>time_period</code>s can also be used with monthly or yearly
data but such data are not regular. This is approximately handles and
irregular date periods are generally OK to use with
<code>ggoutbreak</code>. Some functions like <code>date_seq</code> may
not work as anticipated with irregular dates, and some conversions
between weeks and months for example are potentially risky.</p>
<p>Two time series can be aligned to make them comparable:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">orig_dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">*</span><span class="fl">7</span></span>
<span></span>
<span><span class="co"># a 2 daily time series based on weekly dates</span></span>
<span><span class="va">t1</span> <span class="op">=</span> <span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="va">orig_dates</span>, unit <span class="op">=</span> <span class="st">"2 days"</span>, start_date <span class="op">=</span> <span class="st">"2021-01-01"</span><span class="op">)</span></span>
<span><span class="va">t1</span></span>
<span><span class="co">#&gt; time unit: 2 days, origin: 2021-01-01 (a Friday)</span></span>
<span><span class="co">#&gt;  [1] 847.5 851.0 854.5 858.0 861.5 865.0 868.5 872.0 875.5 879.0</span></span>
<span></span>
<span><span class="co"># a weekly with different start date</span></span>
<span><span class="va">t2</span> <span class="op">=</span> <span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="va">orig_dates</span>, unit <span class="op">=</span> <span class="st">"1 week"</span>, start_date <span class="op">=</span> <span class="st">"2022-01-01"</span><span class="op">)</span></span>
<span><span class="va">t2</span></span>
<span><span class="co">#&gt; time unit: week, origin: 2022-01-01 (a Saturday)</span></span>
<span><span class="co">#&gt;  [1] 190 191 192 193 194 195 196 197 198 199</span></span>
<span></span>
<span><span class="co"># rebase t1 into the same format as t2</span></span>
<span><span class="co"># as t1 and t2 based on the same original dates converting t2 onto the same</span></span>
<span><span class="co"># peridicty as t1 results in an identical set of times</span></span>
<span><span class="va">t3</span> <span class="op">=</span> <span class="fu"><a href="../reference/as.time_period.html">as.time_period</a></span><span class="op">(</span><span class="va">t1</span>,<span class="va">t2</span><span class="op">)</span></span>
<span><span class="va">t3</span></span>
<span><span class="co">#&gt; time unit: week, origin: 2022-01-01 (a Saturday)</span></span>
<span><span class="co">#&gt;  [1] 190 191 192 193 194 195 196 197 198 199</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="times-in-ggoutbreak-and-conversion-of-line-lists">Times in <code>ggoutbreak</code> and conversion of line-lists<a class="anchor" aria-label="anchor" href="#times-in-ggoutbreak-and-conversion-of-line-lists"></a>
</h2>
<p><code>ggoutbreak</code> uses the <code>time_period</code> class
internally extensively. Casting dates to and from
<code>time_periods</code> is all that generally needs to be done before
using <code>ggoutbreak</code>. Most of the functions in
<code>ggoutbreak</code> operate on time series data which expect a
unique (and usually complete) set of data on a periodic time.</p>
<p>To help prepare line-list data into time series there is the
<code><a href="../reference/time_summarise.html">time_summarise()</a></code> function. A minimal line-list will have a
date column and nothing else.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">random_dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">21</span>,<span class="fl">50</span>,replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">linelist</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">random_dates</span><span class="op">)</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/time_summarise.html">time_summarise</a></span><span class="op">(</span>unit<span class="op">=</span><span class="st">"1 week"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ time  <span style="color: #949494; font-style: italic;">&lt;time_prd&gt;</span> 0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2</span></span>
<span><span class="co">#&gt; $ count <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 27<span style="color: #949494;">, </span>17<span style="color: #949494;">, </span>6</span></span></code></pre></div>
<p>If the line-list contains a <code>class</code> column it is
interpreted as a complete record of all possible options from which we
can calculate a denominator. In this case the positive and negative
results of a test:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">random_dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">21</span>,<span class="fl">200</span>,replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">linelist2</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">random_dates</span>,</span>
<span>  class <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">1</span>, <span class="fl">0.04</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="st">"positive"</span>,<span class="st">"negative"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">linelist2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/time_summarise.html">time_summarise</a></span><span class="op">(</span>unit<span class="op">=</span><span class="st">"1 week"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 6</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Groups: class [2]</span></span>
<span><span class="co">#&gt; $ class <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "negative"<span style="color: #949494;">, </span>"negative"<span style="color: #949494;">, </span>"negative"<span style="color: #949494;">, </span>"positive"<span style="color: #949494;">, </span>"positive"<span style="color: #949494;">, </span>"pos…</span></span>
<span><span class="co">#&gt; $ time  <span style="color: #949494; font-style: italic;">&lt;time_prd&gt;</span> 0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2</span></span>
<span><span class="co">#&gt; $ count <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 52<span style="color: #949494;">, </span>66<span style="color: #949494;">, </span>73<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3</span></span>
<span><span class="co">#&gt; $ denom <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 56<span style="color: #949494;">, </span>68<span style="color: #949494;">, </span>76<span style="color: #949494;">, </span>56<span style="color: #949494;">, </span>68<span style="color: #949494;">, </span>76</span></span></code></pre></div>
<p>In this specific example subsequent analysis with
<code>ggoutbreak</code> may focus on the <code>positive</code> subgroup
only, as the comparison between <code>positive</code> and
<code>negative</code> test results is trivial. In another example
<code>class</code> may not be test results, it could be any other major
subdivision e.g. the variant of a disease. In this case the comparison
between different groups may be much more relevant. The use of
<code>class</code> as the major sub-group is for convenience. Additional
grouping other than <code>class</code> columns is also possible for
multi-faceted comparisons, and grouping is preserved but not included
automatically in the denominator, which may need to be manually
calculated:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">random_dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">21</span>,<span class="fl">200</span>,replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">variant</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linelist3</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="va">random_dates</span>,</span>
<span>  class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"variant1"</span>,<span class="st">"variant2"</span>,<span class="st">"variant3"</span><span class="op">)</span><span class="op">[</span><span class="va">variant</span><span class="op">]</span>,</span>
<span>  gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>,<span class="st">"male"</span>,<span class="st">"female"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">count_by_gender</span> <span class="op">=</span> <span class="va">linelist3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/time_summarise.html">time_summarise</a></span><span class="op">(</span>unit<span class="op">=</span><span class="st">"1 week"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">gender</span>, <span class="va">class</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 18</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Groups: gender, class [6]</span></span>
<span><span class="co">#&gt; $ gender <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "female"<span style="color: #949494;">, </span>"female"<span style="color: #949494;">, </span>"female"<span style="color: #949494;">, </span>"male"<span style="color: #949494;">, </span>"male"<span style="color: #949494;">, </span>"male"<span style="color: #949494;">, </span>"female"<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ class  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "variant1"<span style="color: #949494;">, </span>"variant2"<span style="color: #949494;">, </span>"variant3"<span style="color: #949494;">, </span>"variant1"<span style="color: #949494;">, </span>"variant2"<span style="color: #949494;">, </span>"va…</span></span>
<span><span class="co">#&gt; $ time   <span style="color: #949494; font-style: italic;">&lt;time_prd&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2</span></span>
<span><span class="co">#&gt; $ count  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 5<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>17<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>24<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>25<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>25<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>12</span></span>
<span><span class="co">#&gt; $ denom  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 34<span style="color: #949494;">, </span>34<span style="color: #949494;">, </span>34<span style="color: #949494;">, </span>33<span style="color: #949494;">, </span>33<span style="color: #949494;">, </span>33<span style="color: #949494;">, </span>36<span style="color: #949494;">, </span>36<span style="color: #949494;">, </span>36<span style="color: #949494;">, </span>34<span style="color: #949494;">, </span>34<span style="color: #949494;">, </span>34<span style="color: #949494;">, </span>38<span style="color: #949494;">, </span>38<span style="color: #949494;">, </span>38…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="aggregating-time-series-datasets-">Aggregating time series datasets.<a class="anchor" aria-label="anchor" href="#aggregating-time-series-datasets-"></a>
</h2>
<p>In the case of a time series with additional grouping present,
removing a level of grouping whilst retaining time is made easier with
<code><a href="../reference/time_aggregate.html">time_aggregate()</a></code>. In this case we wish to sum
<code>count</code> and <code>denom</code> by gender, retaining the class
grouping.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">count_by_gender</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">class</span>,<span class="va">gender</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/time_aggregate.html">time_aggregate</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 9</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Groups: class [3]</span></span>
<span><span class="co">#&gt; $ class <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "variant1"<span style="color: #949494;">, </span>"variant1"<span style="color: #949494;">, </span>"variant1"<span style="color: #949494;">, </span>"variant2"<span style="color: #949494;">, </span>"variant2"<span style="color: #949494;">, </span>"var…</span></span>
<span><span class="co">#&gt; $ time  <span style="color: #949494; font-style: italic;">&lt;time_prd&gt;</span> 0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2</span></span>
<span><span class="co">#&gt; $ count <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 7<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>17<span style="color: #949494;">, </span>16<span style="color: #949494;">, </span>16<span style="color: #949494;">, </span>43<span style="color: #949494;">, </span>49<span style="color: #949494;">, </span>37</span></span>
<span><span class="co">#&gt; $ denom <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 67<span style="color: #949494;">, </span>70<span style="color: #949494;">, </span>63<span style="color: #949494;">, </span>67<span style="color: #949494;">, </span>70<span style="color: #949494;">, </span>63<span style="color: #949494;">, </span>67<span style="color: #949494;">, </span>70<span style="color: #949494;">, </span>63</span></span></code></pre></div>
<p>by default <code>time_aggregate</code> will sum any of
<code>count</code>, <code>denom</code> and <code>population</code>
columns but any other behaviour can be specified by passing
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise</a></code> style directives to the function.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
